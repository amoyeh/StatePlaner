var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},sp;!function(a){var b=function(){function a(a,b,c){void 0===c&&(c=null),this.target=a,this.type=b,this.values=c}return a}();a.StateEvent=b;var c=function(){function a(){this.callBacks=[]}return a.prototype.addEvent=function(a,b){null==this.callBacks[a]&&(this.callBacks[a]=[]),this.callBacks[a].push({func:b})},a.prototype.removeEvent=function(a,b){if(null!=this.callBacks[a])for(var c=this.callBacks[a].length,d=0;c>d;d++)if(this.callBacks[a][d].func===b){this.callBacks[a].splice(d,1);break}},a.prototype.hasEvent=function(a,b){if(null!=this.callBacks[a])for(var c=this.callBacks[a].length,d=0;c>d;d++)if(this.callBacks[a][d].func===b)return!0;return!1},a.prototype.fireEvent=function(a){if(null!=this.callBacks[a.type])for(var b=this.callBacks[a.type].length,c=0;b>c;c++)this.callBacks[a.type][c].func(a)},a}();a.EventDispatcher=c;var d=function(a){function b(b,c,d){void 0===c&&(c=!1),void 0===d&&(d=!1),a.call(this),this.treeDeep=0,this.name=b,this.transitions=[],this.childs={},this.isInitial=c,this.isFinal=d}return __extends(b,a),b.prototype.addChild=function(){for(var a=[],c=0;c<arguments.length;c++)a[c-0]=arguments[c];for(var d=0;d<a.length;d++)if(a[d].constructor==b){var f=a[d];if(f.parent&&f.parent.removeChild(f),this.childs[f.name])return;this.childs[f.name]=f,f.parent=this,this.constructor!=e&&f.addTransition(this),this.addTransition(f)}},b.prototype.removeChild=function(a){this.childs[a.name]&&(this.childs[a.name].parent=null,delete this.childs[a.name])},b.prototype.addTransition=function(a,b){void 0===b&&(b=!1),-1==this.transitions.indexOf(a.name)&&this.name!=a.name&&this.transitions.push(a.name),b&&-1==a.transitions.indexOf(this.name)&&a.name!=this.name&&a.transitions.push(this.name)},b.prototype.deleteTransition=function(a,b){void 0===b&&(b=!1);var c=this.transitions.indexOf(a.name);if(c>-1&&this.transitions.splice(c,1),b){var d=a.transitions.indexOf(this.name);d>-1&&a.transitions.splice(d,1)}},b.prototype.treeLoop=function(a,b,c){c++;for(var d in this.childs){var e=this.childs[d];b.allStates[e.name]||(b.allStates[e.name]=e,e.fsm=b,e.treeDeep=c),e.treeLoop(e,b,c)}},b.prototype.enter=function(){},b.prototype.exit=function(){},b.prototype.hasChild=function(){for(var a in this.childs)return!0;return!1},b}(c);a.State=d;var e=function(a){function c(b){a.call(this,b),this.history=[]}return __extends(c,a),c.prototype.printTreeInfo=function(){var a=this.name;for(var b in this.allStates){for(var c=this.allStates[b],d=3*c.treeDeep,e="";d>-1;)e+=" ",d--;var f="";c.isInitial&&(f+=" (I)"),c.isFinal&&(f+=" (F)"),a+="\n"+e+c.name+f}return a},c.prototype.getState=function(a){return this.allStates[a]},c.prototype.buildTree=function(){function a(b,c){for(var d in c.childs)b.allChilds.push(c.childs[d].name),a(b,c.childs[d])}this.history=[],this.allStates={},this.treeLoop(this,this,0);for(var b in this.allStates){var c=this.allStates[b];if(c.allParents=[],c.parent)for(var d=c.parent;void 0!=d;)c.allParents.push(d.name),d=d.parent;for(var b in this.allStates){var c=this.allStates[b];if(c.isFinal&&c.parent){var e=[];for(var b in c.parent.childs){var f=c.parent.childs[b];f.name!=c.name&&e.push(f.name)}for(var g=c.parent.transitions,h=g.length,i=0;h>i;i++)if(-1==e.indexOf(g[i])&&g[i]!=c.name){var j=this.allStates[g[i]];c.addTransition(j)}}}c.allChilds=[];var k=!1;for(var l in c.childs){k=!0;break}k&&a(c,c)}},c.prototype.getCurrentState=function(){var a=this;return this.history.length>0&&(a=this.allStates[this.history[this.history.length-1]]),a},c.prototype.getPreviousState=function(a){var b=null;return this.history.length>=a&&(b=this.allStates[this.history[this.history.length-a-1]]),b},c.prototype.toState=function(a){var c=this.getCurrentState(),d=this.allStates[a];if(c.transitions.indexOf(a)>-1){-1==d.allParents.indexOf(c.name)&&(this.fireEvent(new b(c,c.name+".exit",{next:d.name})),c.exit(c,this,d.name)),this.fireEvent(new b(d,d.name+".enter",{from:c.name})),d.enter(d,this,c.name),this.history.push(d.name);for(var e in d.childs)d.childs[e].isInitial&&(this.fireEvent(new b(d.childs[e],d.childs[e].name+".enter",{from:c.name})),d.childs[e].enter(d.childs[e],this,c.name),this.history.push(d.childs[e].name));return d.isFinal&&d.parent&&(this.fireEvent(new b(d,d.name+".exit")),d.exit(d,this,""),this.fireEvent(new b(d.parent,d.parent.name+".exit")),d.parent.exit(d.parent,this,"")),!0}return!1},c.prototype.setDebugUI=function(a){function b(a,c,d){var e,f="";a.isInitial&&(f=" (init)"),a.isFinal&&(f=" (final)");var g=$('<li data-trans="'+a.transitions.join(",")+'">'+a.name+f+"</li>");if($(g).css({"font-weight":"normal",color:"#333","text-decoration":"none"}),d.append(g),a.hasChild()){e=$("<ul></ul>"),d.append(e);for(var h in a.childs)b(a.childs[h],a,e)}}a.empty();var c=$("<div></div>");c.css({color:"#333333",cursor:"pointer"}),c.text(this.name),a.append(c);var d=a.append("<ul></ul>").find("ul");for(var e in this.childs){var f=this.childs[e];b(f,this,d)}var g=$("<div></div>");a.append(g),d.find("li").each(function(){$(this).css({cursor:"pointer"}),$(this).on("click",function(a){var b=$(a.currentTarget).attr("data-trans").split(",");d.find("li").each(function(){var a=$(this).text();a=a.replace(" (init)",""),a=a.replace(" (final)",""),$(this).css(b.indexOf(a)>-1?{"font-weight":"bold",color:"#FF6666","text-decoration":"none","font-size":"100%"}:{"font-weight":"normal",color:"#333","text-decoration":"none","font-size":"100%"})}),$(this).css({color:"#CC3300","font-weight":"bold","text-decoration":"underline","font-size":"120%"});var c=$(a.currentTarget).attr("data-trans");c=c.replace(/,/g," , "),g.html("state: "+$(this).text()+"  <span style='padding-left:30px; '>  transitions: "+c+"</span>")})}),c.on("click",function(){d.find("li").each(function(){$(this).css({"font-weight":"normal",color:"#333","text-decoration":"none","font-size":"100%"}),g.html("")})})},c}(d);a.FSM=e}(sp||(sp={}));